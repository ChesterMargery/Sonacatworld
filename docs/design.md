# AI 小镇 - 完整策划案

## 一、项目核心

利用 **LLM 多人格异步调用 + WebGPU 并行计算**，构建 AI 驱动小镇仿真系统。

### 核心理念

本项目旨在创建一个自主运行的 AI 社会生态系统，通过大语言模型赋予每个虚拟角色独立的思考能力和人格特征，在资源约束、经济系统和社交博弈的多重作用下，观察涌现出的复杂社会行为模式。

## 二、系统构成

### 1. 经济系统（杂货铺）

#### 功能定位
杂货铺是小镇的唯一交易中心，是经济系统的核心枢纽。

#### 可交易物品

**农作物类**
- 小麦（Wheat）
- 大米（Rice）
- 萝卜（Carrot）
- 甜菜（Beet）

**鱼类**
- 普通鱼（Common Fish）
- 稀有鱼（Rare Fish）
- 银鱼（Silver Fish）
- 金鱼（Golden Fish）
- 传说之鱼（Legendary Fish）

**矿物类**
- 铜矿（Copper）
- 铁矿（Iron）
- 银矿（Silver）
- 金矿（Gold）

#### 交易规则

1. **出售机制**：AI 可以将采集/生产的资源出售给杂货铺换取金钱
2. **购买机制**：AI 使用金钱购买食物（恢复饥饿）或种子（用于种植）
3. **价格体系**：
   - 基础价格由物品类型决定
   - 可选实现动态价格（供需关系影响）
4. **库存管理**：杂货铺维护商品库存池

### 2. 农业系统

#### 作物类型

| 作物 | 种子 | 生长时间 | 饥饿恢复值 | 售价 |
|------|------|----------|------------|------|
| 小麦 | 小麦种子 | 5分钟 | 20 | 15金币 |
| 大米 | 大米种子 | 8分钟 | 30 | 25金币 |
| 萝卜 | 萝卜种子 | 3分钟 | 15 | 10金币 |
| 甜菜 | 甜菜种子 | 6分钟 | 25 | 20金币 |

#### 种植流程

1. **购买种子**：从杂货铺购买对应作物的种子
2. **播种**：在农田中种下种子
3. **生长**：等待作物生长（实时计时）
4. **收获**：生长完成后收获作物
5. **利用**：选择食用（恢复饥饿）或出售（获得金钱）

#### 系统特性

- 每个角色可拥有多个农田地块
- 农田数量可扩展（需要金钱投资）
- 作物生长期间可观察生长状态
- 未及时收获的作物可能枯萎（可选机制）

### 3. 人物属性系统

#### 核心属性

**饥饿值（Hunger）**
- 初始值：100
- 范围：0-100
- 变化规则：
  - 每分钟自然下降 0.5
  - 进食恢复（根据食物类型）
  - 饥饿值 ≤ 0 时角色无法进行大部分活动
  - 饥饿值影响 AI 决策优先级

**金钱（Money）**
- 初始值：100 金币
- 范围：0-∞
- 获取途径：
  - 出售农作物
  - 出售鱼类
  - 出售矿物
  - 参与礼堂活动奖励（可选）
- 消费途径：
  - 购买食物
  - 购买种子
  - 购买工具（可选）
  - 扩展农田（可选）

**年龄（Age）**
- 计算方式：游戏时长 1 小时 = 1 岁
- 初始年龄：18-25 岁随机
- 作用：
  - 记录角色在小镇的经历时长
  - 可影响某些社交活动的参与条件
  - 长期记忆积累的指标

#### 派生状态

- **健康状态**：基于饥饿值判定（健康/饥饿/濒临饿死）
- **经济状态**：基于金钱判定（富裕/普通/贫困）
- **活动能力**：基于饥饿值和金钱综合判定

### 4. 钓鱼系统

#### 鱼类分级

| 鱼类 | 稀有度 | 钓获概率 | 饥饿恢复值 | 售价 |
|------|--------|----------|------------|------|
| 普通鱼 | Common | 50% | 15 | 8金币 |
| 稀有鱼 | Rare | 30% | 25 | 20金币 |
| 银鱼 | Uncommon | 15% | 35 | 40金币 |
| 金鱼 | Epic | 4% | 50 | 80金币 |
| 传说之鱼 | Legendary | 1% | 80 | 200金币 |

#### 钓鱼机制

1. **资源池抽取**：每次钓鱼从资源池中随机抽取
2. **时间消耗**：每次钓鱼耗时 30 秒（游戏时间）
3. **技能影响**（可选）：钓鱼次数提升稀有鱼概率
4. **环境因素**（可选）：不同时段影响鱼类分布

#### 使用方式

- **直接食用**：恢复对应的饥饿值
- **出售获利**：在杂货铺卖出换取金钱

### 5. 挖矿系统

#### 矿物类型

| 矿物 | 稀有度 | 挖获概率 | 售价 |
|------|--------|----------|------|
| 铜矿 | Common | 50% | 15金币 |
| 铁矿 | Uncommon | 35% | 30金币 |
| 银矿 | Rare | 12% | 60金币 |
| 金矿 | Epic | 3% | 150金币 |

#### 挖矿机制

1. **矿场资源池**：矿场维护有限的矿物资源池
2. **开采消耗**：每次挖矿消耗矿场库存
3. **资源刷新**：矿场资源池定期补充（如每小时）
4. **时间消耗**：每次挖矿耗时 45 秒（游戏时间）

#### 矿物用途

- **主要用途**：出售换取金钱（矿物不可食用）
- **特殊用途**（可选）：作为工具升级材料

### 6. 人物行为系统

#### 基础行为列表

**生存类行为**
1. **睡觉**：恢复体力，推进游戏时间
2. **起床**：开始新的一天
3. **吃东西**：消耗食物恢复饥饿值

**移动类行为**
4. **行走**：在小镇不同地点间移动

**生产类行为**
5. **种植**：播种农作物
6. **收获**：采收成熟的作物
7. **钓鱼**：前往钓鱼点钓鱼
8. **挖矿**：前往矿场挖矿

**经济类行为**
9. **买东西**：在杂货铺购买物品
10. **卖东西**：在杂货铺出售物品

**社交类行为**
11. **对话**：与其他 AI 角色交流
12. **参加礼堂活动**：参与社交博弈游戏

#### 行为决策机制

AI 基于以下因素进行行为决策：

1. **当前状态**
   - 饥饿值：低时优先寻找食物
   - 金钱：低时优先赚钱活动
   - 时间：影响可进行的活动类型

2. **人格目标**
   - 贪婪型：优先积累金钱
   - 社交型：优先参与社交活动
   - 勤劳型：优先生产活动
   - 享乐型：注重即时满足

3. **世界信息**
   - 杂货铺价格
   - 其他角色位置
   - 可用资源状态

4. **记忆影响**
   - 过往成功经验
   - 与其他角色的关系
   - 礼堂活动中的博弈记忆

### 7. 礼堂系统（社交与博弈）

#### 活动类型

**狼人杀（阵营推理）**
- **参与人数**：6-12 人
- **角色分配**：狼人、村民、预言家、女巫等
- **游戏流程**：
  - 夜晚阶段：狼人杀人，特殊角色行动
  - 白天阶段：全体讨论，投票放逐
  - LLM 驱动每个角色的发言、推理和投票
- **记忆形成**：
  - 对其他角色的信任/怀疑程度
  - 发言风格和行为模式记忆
  - 背叛或合作经历

**剧本杀（身份与记忆博弈）**
- **参与人数**：4-8 人
- **机制特点**：
  - 每个角色有独特背景故事
  - 部分信息公开，部分信息私密
  - 通过对话交换信息、推理真相
- **LLM 应用**：
  - 理解并扮演剧本角色
  - 策略性地透露/隐藏信息
  - 基于线索推理

**讨论信息会**
- **形式**：开放式话题讨论
- **话题类型**：
  - 小镇资源状况交流
  - 合作计划商讨
  - 纯粹社交聊天
- **作用**：
  - 信息共享
  - 建立社交关系
  - 形成合作或竞争关系

#### 社交关系系统

**关系类型**
- **信任**：合作倾向高，信息交流开放
- **中立**：普通交往
- **怀疑**：保持警惕，信息保留
- **敌对**：竞争关系，可能阻碍对方

**关系影响**
- 影响日常对话内容和意愿
- 影响交易合作倾向
- 影响礼堂活动中的站队
- 影响信息分享程度

### 8. LLM 分裂系统（多人格异步）

#### 系统架构

**单一模型，多重人格**
- 使用同一个 LLM API（如 GPT-4、Claude 等）
- 通过不同的 System Prompt 实现人格分裂
- 每个角色维护独立的对话上下文

#### 人格设定

每个 AI 角色包含：

1. **基础信息**
   - 姓名、年龄、性别
   - 外观描述（文本）

2. **人格特质**
   - 核心性格（如：乐观/悲观、外向/内向）
   - 价值观倾向（如：重视金钱/重视关系）
   - 行为偏好（如：冒险/保守、勤奋/懒惰）

3. **目标导向**
   - 短期目标（如：今天赚 50 金币）
   - 长期目标（如：成为小镇首富）
   - 社交目标（如：结交 5 个朋友）

#### 决策输入

LLM 决策时接收的信息：

1. **角色状态**
   ```json
   {
     "hunger": 45,
     "money": 120,
     "age": 23,
     "location": "home",
     "inventory": ["wheat", "carrot"],
     "time": "14:30"
   }
   ```

2. **世界信息**
   ```json
   {
     "shopPrices": {
       "wheat": 15,
       "fish": 20
     },
     "nearbyCharacters": ["Alice", "Bob"],
     "weather": "sunny",
     "availableActivities": ["farming", "fishing", "shopping"]
   }
   ```

3. **社交记忆**
   ```json
   {
     "relationships": {
       "Alice": {"trust": 0.8, "lastInteraction": "friendly chat"},
       "Bob": {"trust": 0.3, "lastInteraction": "he betrayed me in werewolf"}
     },
     "recentEvents": [
       "Lost in werewolf game",
       "Sold wheat for 45 coins"
     ]
   }
   ```

#### 行为输出

LLM 返回的决策格式：

```json
{
  "action": "go_fishing",
  "reasoning": "I'm low on money and fishing can help me earn some coins",
  "emotion": "hopeful",
  "internalThought": "If I catch a golden fish, I'll be rich!"
}
```

#### 异步调用机制

1. **并发决策**：多个 AI 可同时请求决策
2. **时间切片**：按游戏时间周期触发决策
3. **事件驱动**：特定事件（如被对话）触发即时决策
4. **优先级队列**：管理 LLM API 调用优先级

#### 记忆管理

**短期记忆**
- 当前会话上下文（最近 10-20 条交互）
- 即时状态变化

**长期记忆**
- 重要事件摘要（通过 LLM 总结）
- 关系网络数据
- 人格发展轨迹

**记忆检索**
- 使用向量数据库（如 Pinecone）存储记忆
- 基于当前情境检索相关历史记忆
- 注入到 LLM 上下文中

## 三、技术实现

### 前端架构

**WebGPU 应用**
- **仿真计算**：角色状态更新、资源池计算
- **渲染**：2D/简单 3D 场景渲染
- **性能优化**：利用 GPU 并行处理大量 AI 角色

**TypeScript**
- 类型安全的游戏逻辑
- 模块化系统设计
- 易于维护和扩展

**Vite**
- 快速开发热更新
- 优化的生产构建
- 现代化的开发体验

### 后端/AI 架构

**LLM 集成**
- 支持多种 LLM 提供商（OpenAI、Anthropic、本地模型等）
- API 调用管理和错误处理
- Token 使用优化

**状态管理**
- 集中式状态管理（或使用状态管理库）
- 角色状态持久化
- 世界状态同步

### 约束条件

**不使用游戏引擎**
- 纯 Web 技术实现
- WebGPU 原生开发
- 自主控制所有逻辑

**不制作自定义美术资源**
- 使用简单几何图形
- 使用免费字体和图标库
- 专注于系统逻辑而非视觉效果

## 四、项目目标

### 核心闭环

```
生产（farming/fishing/mining）
  ↓
采集（收获资源）
  ↓
交易（在杂货铺买卖）
  ↓
生存（管理饥饿和金钱）
  ↓
社交（对话和关系建立）
  ↓
博弈（礼堂活动）
  ↓
记忆（形成经验和关系网）
  ↓
决策演化（人格和策略发展）
  ↓
（循环回生产）
```

### 观察目标

**经济循环**
- 资源产出和消耗的平衡
- 价格波动（如果实现动态定价）
- 贫富分化现象

**行为分化**
- 不同人格的行为模式差异
- 优势策略的涌现
- 职业分工的自发形成

**社交冲突**
- 合作与竞争关系的形成
- 信任网络的构建
- 背叛和复仇行为

**人格涌现**
- 角色在长期交互中发展出独特性格
- 基于经历的人格变化
- 社群文化的形成

### 可扩展方向

1. **系统深化**
   - 更复杂的经济模型（供需、通胀）
   - 更多资源类型和生产链
   - 技能系统和角色成长

2. **社交扩展**
   - 家庭和婚姻系统
   - 派系和组织
   - 政治和权力结构

3. **技术优化**
   - 更高效的 LLM 调用策略
   - 更丰富的可视化效果
   - 多玩家参与（人类玩家）

4. **内容增加**
   - 更多礼堂活动类型
   - 季节和天气系统
   - 随机事件和灾难

## 五、开发路线图

### 阶段一：基础框架（当前）
- ✅ 项目初始化和目录结构
- ✅ 核心类和接口设计
- ✅ 基础文档完善

### 阶段二：核心系统
- [ ] 角色属性系统实现
- [ ] 经济系统（杂货铺）实现
- [ ] 农业系统实现
- [ ] 基础 LLM 集成

### 阶段三：资源系统
- [ ] 钓鱼系统实现
- [ ] 挖矿系统实现
- [ ] 资源池管理

### 阶段四：行为与 AI
- [ ] 行为系统框架
- [ ] LLM 决策引擎
- [ ] 多人格管理

### 阶段五：社交系统
- [ ] 基础对话系统
- [ ] 关系系统
- [ ] 礼堂活动框架

### 阶段六：渲染与交互
- [ ] WebGPU 渲染实现
- [ ] UI 界面
- [ ] 可视化展示

### 阶段七：优化与完善
- [ ] 性能优化
- [ ] 记忆系统优化
- [ ] 平衡性调整
- [ ] 文档完善

---

**最后更新**：2026-01-15
