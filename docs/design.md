# Sonacatworld 完整策划案

## 项目定位

Sonacatworld（索纳猫世界）是一个基于 **LLM (大语言模型) + WebGPU** 技术的多智能体社会模拟系统。本项目旨在创建一个由AI驱动的虚拟小镇，其中每个居民都拥有独立的人格、记忆和决策能力，能够自主进行生产、社交、博弈等复杂行为。

---

## 核心设计理念

1. **真实感社会生态**：构建包含经济、生产、社交的完整生态系统
2. **AI驱动自主性**：所有居民行为由LLM智能决策，而非预设脚本
3. **记忆与关系**：AI之间建立持久的关系记忆网络
4. **技术创新**：不使用传统游戏引擎，直接基于WebGPU构建

---

## 系统架构总览

### 技术选型

- **前端**: 纯 WebGPU (无游戏引擎)
- **AI引擎**: 在线LLM服务
- **图形**: 基础图形渲染
- **语言**: TypeScript (严格模式)

### 系统分层

```
用户交互层 (WebGPU UI)
    ↓
核心系统层 (经济、人物、时间)
    ↓
功能模块层 (农业、钓鱼、挖矿、社交)
    ↓
AI决策层 (LLM多人格异步调用)
```

---

## 详细系统设计

## 一、经济系统（杂货铺）

### 1.1 核心定位

杂货铺是小镇的**唯一交易中心**，是所有经济活动的枢纽。

### 1.2 可交易物品

#### 农作物类
- **小麦** (Wheat)
- **大米** (Rice)
- **萝卜** (Turnip)
- **甜菜** (Beet)

#### 鱼类
- **普通鱼** (Common Fish)
- **稀有鱼** (Rare Fish)
- **珍稀鱼** (Very Rare Fish)
- **史诗鱼** (Epic Fish)
- **传说鱼** (Legendary Fish)

#### 矿物类
- **铜矿** (Copper)
- **铁矿** (Iron)
- **银矿** (Silver)
- **金矿** (Gold)

#### 种子类
- **小麦种子** (Wheat Seeds)
- **大米种子** (Rice Seeds)
- **萝卜种子** (Turnip Seeds)
- **甜菜种子** (Beet Seeds)

### 1.3 交易机制

#### 卖出 (AI → 杂货铺)
AI居民可以出售：
- 收获的农作物
- 钓到的鱼
- 挖到的矿物

获得金钱用于购买食物和种子。

#### 买入 (杂货铺 → AI)
AI居民可以购买：
- 食物（农作物、鱼类）用于恢复饥饿值
- 种子用于种植

### 1.4 定价系统

每种物品都有基础价格，可在后续版本中加入：
- 供需关系影响价格
- 季节性价格波动
- 稀有度价格梯度

---

## 二、农业系统

### 2.1 作物种类

| 作物 | 种子 | 生长时间 | 饥饿恢复 | 售价 | 种子价格 |
|------|------|----------|----------|------|----------|
| 小麦 | 小麦种子 | 3天 | 15 | 30金 | 10金 |
| 大米 | 大米种子 | 4天 | 20 | 40金 | 15金 |
| 萝卜 | 萝卜种子 | 2天 | 10 | 20金 | 5金 |
| 甜菜 | 甜菜种子 | 5天 | 25 | 50金 | 20金 |

### 2.2 农业流程

1. **购买种子**：从杂货铺购买
2. **播种**：在农田中种植
3. **生长**：经过指定天数后成熟
4. **收获**：获得农作物
5. **选择**：
   - 食用（恢复饥饿值）
   - 出售（获得金钱）

### 2.3 农田系统

- 每个AI居民可以拥有多块农田
- 每块农田同时只能种植一种作物
- 需要管理种植时间和收获时机

---

## 三、人物属性系统

### 3.1 核心属性

#### 饥饿值 (Hunger)
- **初始值**: 100
- **最大值**: 100
- **最小值**: 0
- **变化规律**: 随游戏时间自然下降
- **恢复方式**: 进食（农作物、鱼类）
- **影响**: 饥饿值过低影响行为决策，可能优先选择觅食

#### 金钱 (Money)
- **初始值**: 100金
- **获取方式**: 出售物品（农作物、鱼类、矿物）
- **消耗方式**: 购买种子、食物
- **作用**: 经济系统核心，支持所有交易行为

#### 年龄 (Age)
- **计算方式**: 基于游戏时长换算
- **作用**: 
  - 显示游戏进度
  - 后续可扩展生命周期系统

### 3.2 状态属性

- **当前位置** (Position)
- **当前行为** (Current Action)
- **库存物品** (Inventory)

---

## 四、钓鱼系统

### 4.1 鱼类设计

| 鱼类 | 稀有度 | 捕获概率 | 饥饿恢复 | 售价 |
|------|--------|----------|----------|------|
| 普通鱼 | 普通 | 50% | 10 | 15金 |
| 稀有鱼 | 稀有 | 30% | 15 | 30金 |
| 珍稀鱼 | 珍稀 | 15% | 20 | 60金 |
| 史诗鱼 | 史诗 | 4% | 30 | 120金 |
| 传说鱼 | 传说 | 1% | 50 | 300金 |

### 4.2 钓鱼机制

1. **前往钓鱼点**：AI决策前往河流/湖泊
2. **钓鱼动作**：消耗时间进行钓鱼
3. **概率获取**：基于稀有度随机获得鱼类
4. **处理方式**：
   - 立即食用恢复饥饿值
   - 放入库存稍后食用或出售

### 4.3 钓鱼点设计

- 固定钓鱼点位置
- 可同时容纳多名AI钓鱼
- 天气/时间可影响捕获率（可选扩展）

---

## 五、挖矿系统

### 5.1 矿物类型

| 矿物 | 稀有度 | 获取概率 | 售价 |
|------|--------|----------|------|
| 铜矿 | 普通 | 50% | 20金 |
| 铁矿 | 稀有 | 30% | 50金 |
| 银矿 | 珍稀 | 15% | 100金 |
| 金矿 | 史诗 | 5% | 250金 |

### 5.2 矿场机制

#### 资源池系统
- 矿场有**总资源量**
- 所有AI共享资源池
- 挖掘会消耗资源池
- 资源池定期刷新/补充

#### 挖矿流程
1. **前往矿场**
2. **挖矿动作**：消耗时间
3. **概率获取**：基于稀有度获得矿物
4. **资源池更新**：减少对应资源量
5. **出售矿物**：矿物仅能出售，不能食用

### 5.3 挖矿特点

- **纯经济价值**：矿物不能恢复饥饿值
- **高收益风险**：高价值但需要投入时间
- **资源竞争**：多AI共享资源池，形成竞争关系

---

## 六、人物行为系统

### 6.1 基础行为列表

1. **睡觉 (Sleep)**: 晚上必要行为，恢复状态
2. **起床 (Wake Up)**: 早晨开始新的一天
3. **行走 (Walk)**: 在地图上移动到目标位置
4. **钓鱼 (Fish)**: 前往钓鱼点钓鱼
5. **挖矿 (Mine)**: 前往矿场挖矿
6. **买卖 (Trade)**: 在杂货铺进行交易
7. **吃东西 (Eat)**: 消耗食物恢复饥饿值
8. **对话 (Talk)**: 与其他AI进行对话
9. **参加礼堂活动 (Join Hall Event)**: 参与狼人杀、剧本杀等活动

### 6.2 行为决策机制

#### LLM驱动决策
所有行为由LLM根据以下因素决策：

**状态因素**
- 当前饥饿值
- 当前金钱
- 库存物品
- 当前时间

**人格因素**
- 角色人格设定（勤劳/懒惰、社交/独处等）
- 个人目标（赚钱、社交、探险等）

**环境因素**
- 时间（白天/夜晚）
- 位置
- 周围其他AI

#### 决策示例

**场景1：饥饿值低，金钱充足**
```
LLM决策 → 前往杂货铺 → 购买食物 → 进食
```

**场景2：饥饿值正常，金钱不足**
```
LLM决策 → 前往钓鱼点/矿场 → 获取资源 → 出售换钱
```

**场景3：状态良好，社交人格**
```
LLM决策 → 前往礼堂 → 参加活动 → 社交互动
```

---

## 七、礼堂系统（社交与博弈）

### 7.1 系统定位

礼堂是小镇的**社交中心**，提供多人互动和博弈场景。

### 7.2 活动类型

#### 7.2.1 狼人杀 (Werewolf)
- **参与人数**: 6-12人
- **角色分配**: 狼人、村民、预言家、女巫等
- **游戏流程**:
  1. 夜晚阶段：狼人杀人、预言家查验、女巫救人/毒人
  2. 白天阶段：讨论、投票
  3. 重复直到某方胜利

#### 7.2.2 剧本杀 (Murder Mystery)
- **参与人数**: 4-8人
- **游戏机制**:
  1. 每人获得角色和剧本
  2. 搜证阶段：收集线索
  3. 讨论阶段：推理凶手
  4. 投票揭晓

#### 7.2.3 自由讨论 (Free Discussion)
- **参与人数**: 不限
- **话题类型**:
  - 分享今日经历
  - 讨论小镇事务
  - 闲聊交流

### 7.3 社交关系系统

#### 7.3.1 关系类型

**信任 (Trust)**
- 产生方式：合作成功、诚实对话
- 影响：增加未来合作意愿

**怀疑 (Suspicion)**
- 产生方式：狼人杀中被怀疑、行为异常
- 影响：降低信任度

**敌对 (Hostility)**
- 产生方式：狼人杀中对立、利益冲突
- 影响：减少互动、可能产生竞争

**友谊 (Friendship)**
- 产生方式：多次正面互动、共同兴趣
- 影响：增加主动互动频率

#### 7.3.2 关系记忆

每个AI维护一个**关系记忆表**：

```typescript
{
  "AI_Alice": {
    trust: 0.8,
    suspicion: 0.1,
    friendship: 0.7,
    interactions: [
      { event: "狼人杀-合作胜利", time: "Day3", impact: "+trust" },
      { event: "对话-分享经验", time: "Day5", impact: "+friendship" }
    ]
  },
  "AI_Bob": {
    trust: 0.3,
    suspicion: 0.6,
    hostility: 0.5,
    interactions: [
      { event: "狼人杀-对立", time: "Day2", impact: "+suspicion" },
      { event: "狼人杀-被杀", time: "Day2", impact: "+hostility" }
    ]
  }
}
```

#### 7.3.3 关系影响

关系记忆会影响：
- **对话内容**：信任度高 → 更愿意分享信息
- **合作意愿**：友谊度高 → 更愿意一起活动
- **博弈策略**：敌对度高 → 狼人杀中可能针对
- **经济行为**：信任度高 → 可能产生物品交换

---

## 八、LLM 多人格分裂系统

### 8.1 系统架构

#### 单一模型，多人格Prompt
```
          [在线LLM服务]
               ↓
    ┌──────────┼──────────┐
    ↓          ↓          ↓
[AI_Alice] [AI_Bob]  [AI_Carol]
 人格A       人格B      人格C
```

### 8.2 人格Prompt设计

每个AI拥有独立的系统Prompt：

**示例：勤劳农夫Alice**
```
你是Alice，一个勤劳的农夫。
- 性格：勤奋、节俭、早起早睡
- 目标：积累财富，扩大农田
- 行为倾向：优先种植高价值作物，减少社交时间
- 当前状态：饥饿值 ${hunger}，金钱 ${money}
```

**示例：社交达人Bob**
```
你是Bob，一个热爱社交的居民。
- 性格：外向、健谈、乐于助人
- 目标：结交朋友，参加所有活动
- 行为倾向：优先参加礼堂活动，主动与他人对话
- 当前状态：饥饿值 ${hunger}，金钱 ${money}
```

### 8.3 独立上下文管理

#### 每个AI维护独立的：
1. **系统Prompt**：人格设定
2. **对话历史**：与其他AI的对话记录
3. **行为历史**：过去的行为序列
4. **关系记忆**：与其他AI的关系状态
5. **物品库存**：拥有的物品列表

### 8.4 异步调用机制

#### 决策流程
```
[时间推进] → [触发AI决策]
              ↓
         [读取AI状态]
              ↓
         [构造Prompt]
              ↓
    [异步调用LLM API]
              ↓
         [解析返回结果]
              ↓
         [执行行为动作]
              ↓
         [更新状态]
```

#### 并发优化
- 多个AI可以**并发**调用LLM
- 使用异步队列管理API调用
- 避免阻塞主渲染线程

### 8.5 决策输出格式

LLM返回结构化JSON：

```json
{
  "action": "walk_to_shop",
  "reasoning": "我的饥饿值较低，需要购买食物",
  "target": "杂货铺",
  "next_action": "buy_food"
}
```

---

## 九、时间系统

### 9.1 时间流逝

- **游戏时间**与**现实时间**的换算比例
- 1游戏日 = X现实分钟（可配置）

### 9.2 时间影响

- **白天（6:00-18:00）**: 可进行农业、钓鱼、挖矿、社交
- **夜晚（18:00-6:00）**: 大部分AI睡觉，礼堂可能有夜间活动

### 9.3 事件触发

- **每日刷新**：矿场资源池、商店库存
- **作物成熟**：按种植时间计算
- **定期活动**：礼堂活动时间表

---

## 十、地图与空间系统

### 10.1 地点列表

1. **杂货铺** (General Store)
2. **农田区** (Farm Area)
3. **钓鱼点** (Fishing Spot) - 河流/湖泊
4. **矿场** (Mine)
5. **礼堂** (Community Hall)
6. **住宅区** (Residential Area)

### 10.2 移动系统

- AI通过"行走"行为在地点间移动
- 移动需要消耗游戏时间
- 路径可简单设计为点对点移动

---

## 十一、数据持久化

### 11.1 需要保存的数据

- AI属性状态（饥饿、金钱、库存）
- AI关系记忆
- 农田状态（种植进度）
- 矿场资源池
- 游戏时间

### 11.2 存储方案

- 浏览器 localStorage（简单方案）
- IndexedDB（复杂数据）
- 云端存储（可选扩展）

---

## 十二、开发优先级

### Phase 1: 核心基础
1. 项目架构搭建 ✓
2. WebGPU基础渲染
3. 时间系统
4. 人物属性系统

### Phase 2: 经济与生产
1. 经济系统（杂货铺）
2. 农业系统
3. 钓鱼系统
4. 挖矿系统

### Phase 3: AI决策
1. LLM接口集成
2. 多人格Prompt系统
3. 基础行为决策
4. 状态机实现

### Phase 4: 社交互动
1. 对话系统
2. 关系记忆系统
3. 礼堂活动（自由讨论）
4. 狼人杀/剧本杀

### Phase 5: 优化与扩展
1. UI优化
2. 性能优化
3. 数据持久化
4. 可选扩展功能

---

## 十三、技术挑战与解决方案

### 13.1 WebGPU渲染
**挑战**：无游戏引擎，从零构建渲染
**方案**：
- 使用WebGPU基础图形API
- 简单的2D渲染（优先）
- 模块化渲染组件

### 13.2 LLM调用成本
**挑战**：频繁API调用成本高
**方案**：
- 限制决策频率（非实时）
- 缓存常见决策
- 批量处理多AI决策

### 13.3 状态同步
**挑战**：多AI异步决策可能冲突
**方案**：
- 事务性状态更新
- 资源锁机制（矿场）
- 时间切片处理

### 13.4 记忆管理
**挑战**：长期记忆导致Prompt过长
**方案**：
- 记忆摘要与压缩
- 重要记忆优先保留
- 定期清理过期记忆

---

## 十四、未来扩展方向

### 可选扩展功能
1. **生命周期**：AI会老去和新AI诞生
2. **天气系统**：影响钓鱼、农业效率
3. **技能系统**：AI可提升特定技能等级
4. **建筑系统**：AI可建造和装饰房屋
5. **事件系统**：随机事件影响小镇
6. **多小镇**：AI可在不同小镇间迁移

### 社区功能
1. **玩家观察模式**：观察AI社会发展
2. **玩家干预**：有限的引导或干预
3. **数据可视化**：关系网络、经济曲线

---

## 总结

Sonacatworld 是一个野心勃勃的项目，旨在通过LLM技术创造真正具有"智能"的虚拟社会。核心系统包括：

✅ **经济系统** - 完整的生产与交易循环  
✅ **生产系统** - 农业、钓鱼、挖矿三大产业  
✅ **人物系统** - 饥饿、金钱、年龄三大属性  
✅ **社交系统** - 礼堂活动与关系记忆  
✅ **AI系统** - LLM驱动的多人格异步决策  

所有系统相互关联，形成一个自洽的虚拟生态。AI居民将在这个世界中自主生活、工作、社交，展现出真正的"智能涌现"行为。
